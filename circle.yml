machine:
  services:
    # setup docker
    - docker

dependencies:
  cache_directories:
    - ~/.viadeo # cache viadeo scripts
  pre:
    # setup shared scripts
    - if [[ ! -d ~/.viadeo ]]; then git clone git@github.com:viadeo/viadeo-docker.git ~/.viadeo && git pull; fi   

test:
  pre:
    - docker build -t mysql .
  override:
    - docker run -d -p 13306:3306 mysql
    - sleep 5
    - echo "SELECT 1" | mysql -uroot -h 127.0.0.1 -P13306

deployment:
  demo:
    branch: master
    owner: viadeo
    commands:
      # publish docker image using circle environment variables for project name
      - ~/.viadeo/bin/docker-publish.sh 
