machine:
  services:
    # setup docker
    - docker

dependencies:
  cache_directories:
    - ~/.viadeo # cache viadeo scripts
  pre:
    # setup shared scripts
    - if [[ ! -d ~/.viadeo ]]; then git clone git@github.com:viadeo/viadeo-docker.git ~/.viadeo && git pull; fi   

test:
  pre:
    - docker build -t rabbitmq .
  override:
    - $ docker run -d --hostname my-rabbit --name some-rabbit rabbitmq:3-management
    - sleep 5
    - echo "curl management interface" | curl --retry 10 --retry-delay 5 -v http://localhost:15672

deployment:
  demo:
    branch: master
    owner: viadeo
    commands:
      # publish docker image using circle environment variables for project name
      - ~/.viadeo/bin/docker-publish.sh 
